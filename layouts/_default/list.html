{{ define "main" }}
<div class="page-header content-card">
  {{ if .Title }}
  <h1 class="page-title">{{ .Title }}</h1>
  {{ end }}
  {{ if .Content }}
  <div class="page-description">
    {{ .Content }}
  </div>
  {{ end }}
</div>

<div class="posts-list">
      {{ $paginator := .Paginate (where .Pages.ByDate.Reverse "Type" "post") }}
      {{ range .Paginator.Pages }}
  <article class="content-card post-preview">
    <header class="post-header">
      {{ if .Title }}
      <h2 class="post-title">
        <a href="{{ .Permalink }}" class="text-decoration-none">{{ .Title }}</a>
      </h2>
      {{ end }}
      
      <div class="post-meta">
        {{ if .Date }}
        <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "January 2, 2006" }}</time>
        {{ end }}
        
        {{ if .Params.categories }}
        {{ if .Date }} • {{ end }}
        <span class="categories">
          {{ range $index, $category := .Params.categories }}
            {{ if gt $index 0 }}, {{ end }}
            <a href="{{ "/categories/" | relLangURL }}{{ . | urlize }}" class="category-link">{{ . }}</a>
          {{ end }}
        </span>
        {{ end }}
          </div>
    </header>

    <div class="post-excerpt">
                  {{ if in .RawContent "<!--more-->" }}
                          {{ $splitContents := split .RawContent "<!--more-->" }}
                          {{ $summary := index $splitContents 0 }}
                          {{ $summary := replaceRE "\\[\\^.*?\\]" "" $summary }}
                          {{ $summary := replaceRE "\\n\\[\\^.*?\\]:.*" "" $summary }}
        {{ $summary | markdownify }}
        <p class="mt-3">
          <a class="btn btn-primary btn-sm" href="{{ .Permalink }}">Read more →</a>
        </p>
                  {{ else if .Params.custom_summary }}
        <p>{{ .Summary | safeHTML }}</p>
        <p class="mt-3">
          <a class="btn btn-primary btn-sm" href="{{ .Permalink }}">Read more →</a>
        </p>
      {{ else if .Summary }}
        {{ .Summary }}
        {{ if .Truncated }}
        <p class="mt-3">
          <a class="btn btn-primary btn-sm" href="{{ .Permalink }}">Read more →</a>
        </p>
                  {{ end }}
          {{ else }}
                  {{ .Content }}
      {{ end }}
              </div>

    {{ if .Params.tags }}
    <footer class="post-footer">
      <div class="post-tags">
        {{ range .Params.tags }}
        <span class="badge bg-light text-dark me-1"># {{ . }}</span>
          {{ end }}
      </div>
    </footer>
    {{ end }}
  </article>
  {{ end }}
</div>

{{ if or $paginator.HasPrev $paginator.HasNext }}
<nav class="pagination-nav content-card">
  <div class="d-flex justify-content-between align-items-center">
    <div>
      {{ if $paginator.HasPrev }}
      <a class="btn btn-outline-primary" href="{{ $paginator.Prev.URL }}" title="Previous Page">
        ← Newer Posts
      </a>
      {{ end }}
  </div>
    
    <div class="pagination-info text-muted small">
      Page {{ $paginator.PageNumber }} of {{ $paginator.TotalPages }}
</div>
    
    <div>
    {{ if $paginator.HasNext }}
      <a class="btn btn-outline-primary" href="{{ $paginator.Next.URL }}" title="Next Page">
        Older Posts →
      </a>
    {{ end }}
</div>
  </div>
</nav>
{{ end }}
{{ end }}
